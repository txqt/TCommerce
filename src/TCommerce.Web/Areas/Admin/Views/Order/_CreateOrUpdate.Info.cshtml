@using TCommerce.Core.Models.Orders
@model OrderModel

    <script>
        $(function() {
            toggleChangeOrderStatus(false);
            toggleOrderTotals(false);
        });

        function toggleChangeOrderStatus(editmode) {
            if (editmode) {
                $('#pnlChangeOrderStatus').show();
                $('#btnChangeOrderStatus').hide();
            } else {
                $('#pnlChangeOrderStatus').hide();
                $('#btnChangeOrderStatus').show();
            }
        }

        function toggleOrderTotals(editmode) {
            if (editmode) {
                $('#trEditOrderTotals').show();
                $('#btnEditOrderTotals').hide();
                $('#btnSaveOrderTotals').show();
                $('#btnCancelOrderTotals').show();
            } else {
                $('#trEditOrderTotals').hide();
                $('#btnEditOrderTotals').show();
                $('#btnSaveOrderTotals').hide();
                $('#btnCancelOrderTotals').hide();
            }
        }
    </script>
  
<div class="form-group row">
    <div class="col-md-3">
        <label asp-for="CustomOrderNumber" class="control-label"></label>
    </div>
    <div class="col-md-9">
        <strong>
            <span>@Model.CustomOrderNumber</span>
        </strong>
    </div>
</div>
<div class="form-group row">
    <div class="col-md-3">
        <label asp-for="CreatedOn" class="control-label"></label>
    </div>
    <div class="col-md-9">
        <strong>
            <span >@Model.CreatedOn</span>
        </strong>
    </div>
</div>
<div class="form-group row">
    <div class="col-md-3">
        <label asp-for="CustomerId" class="control-label"></label>
    </div>
    <div class="col-md-9">
        <strong>
            <span>@Model.CustomerId</span>
        </strong>
    </div>
</div>
<div class="form-group row">
    <div class="col-md-3">
        <label asp-for="OrderStatus" class="control-label"></label>
    </div>
    <div class="col-md-9">
        <strong>
            <span>@Model.OrderStatus.ToString()</span>
        </strong>
        @if (Model.CanCancelOrder)
        {
            <button type="submit" name="cancelorder" id="cancelorder" class="btn btn-danger" style="margin-right: 3px;">
                Cancel order
            </button>
            <action-confirmation asp-button-id="cancelorder" />
        }
        <button type="submit" name="btnChangeOrderStatus" onclick="toggleChangeOrderStatus(true);return false;" id="btnChangeOrderStatus" class="btn btn-primary">
            Change status
        </button>
        <div id="pnlChangeOrderStatus">
            <select asp-for="OrderStatusId" asp-items="TEnumExtensions.ToSelectList<OrderStatus>()" class="mt-1"></select>
            <button type="submit" name="btnSaveOrderStatus" id="btnSaveOrderStatus" class="btn btn-primary mt-1 mr-1">
                    Save
                </button>
            <t-action-confirmation asp-button-id="btnSaveOrderStatus" ></t-action-confirmation>
            <button type="submit" name="btnCancelOrderStatus" onclick="toggleChangeOrderStatus(false);return false;" id="btnCancelOrderStatus" class="btn btn-secondary mt-1">
                Cancel
            </button>
            <div class="input-group-btn-hint">
                <em>Order Status Change For Advanced Users</em>
            </div>
        </div>
    </div>
</div>
            
                @if (Model.OrderStatusId == (int)OrderStatus.Cancelled)
                {
                    <div class="form-group row">
                        <div class="col-md-3">
                            &nbsp;
                        </div>
                        <div class="col-md-9">
                            <strong>
                                OrderStatus.CancelledNotification
                            </strong>
                        </div>
                    </div>
                }
            <div class="form-group row">
                <div class="col-md-3">
                    <div class="label-wrapper">
                        <label class="col-form-label">OrderSubtotal</label>
                        <div class="ico-help" title="OrderSubtotal.Hint">
                            <i class="fas fa-question-circle"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="row">
                            <div class="col-md-6">
                                <div class="form-text-row">
                                    @Html.Raw(Model.OrderSubtotalInclTax) <strong>InclTax</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-text-row">
                                    @Html.Raw(Model.OrderSubtotalExclTax) <strong>ExclTax</strong>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
            @if (!string.IsNullOrEmpty(Model.OrderTotalDiscount))
            {
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderTotalDiscount" />
                    </div>
                    <div class="col-md-9">
                        <div class="form-text-row">@Html.Raw(Model.OrderTotalDiscount)</div>
                    </div>
                </div>
            }
            
            <div class="form-group row">
                <div class="col-md-3">
                    <label asp-for="OrderTotal" ></label>
                </div>
                <div class="col-md-9">
                    <div class="form-text-row">@Html.Raw(Model.OrderTotal)</div>
                </div>
            </div>
            @if (!string.IsNullOrEmpty(Model.RefundedAmount))
            {
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="RefundedAmount" />
                    </div>
                    <div class="col-md-9">
                        <div class="form-text-row">@Model.RefundedAmount</div>
                    </div>
                </div>
            }
            @if (Model.UsedDiscounts.Count > 0)
            {
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="UsedDiscounts" />
                    </div>
                    <div class="col-md-9">
                        @for (var i = 0; i < Model.UsedDiscounts.Count; i++)
                        {
                            var discount = Model.UsedDiscounts[i];
                            <a asp-controller="Discount" asp-action="Edit" asp-route-id="@discount.DiscountId">@discount.DiscountName</a>
                            if (i != Model.UsedDiscounts.Count - 1)
                            {
                                <text>,</text>
                            }
                        }
                    </div>
                </div>
            }
            <div class="form-group row">
                <div class="col-md-3">
                    <label asp-for="Profit" />
                </div>
                <div class="col-md-9">
                    <div class="form-text-row">@Html.Raw(Model.Profit)</div>
                </div>
            </div>
            <div id="trEditOrderTotals">
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderSubtotalInclTaxValue" />
                    </div>
                    <div class="col-md-9">
                        <div class="float-left margin-r-10">
                            Edit.InclTax
                            <editor asp-for="OrderSubtotalInclTaxValue" />
                        </div>
                        <div class="float-left">
                            Edit.ExclTax
                            <editor asp-for="OrderSubtotalExclTaxValue" />
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderSubTotalDiscountInclTaxValue" />
                    </div>
                    <div class="col-md-9">
                        <div class="float-left margin-r-10">
                            Edit.InclTax
                            <editor asp-for="OrderSubTotalDiscountInclTaxValue" />
                        </div>
                        <div class="float-left">
                            Edit.ExclTax
                            <editor asp-for="OrderSubTotalDiscountExclTaxValue" />
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderShippingInclTaxValue" />
                    </div>
                    <div class="col-md-9">
                        <div class="float-left margin-r-10">
                            Edit.InclTax
                            <editor asp-for="OrderShippingInclTaxValue" />
                        </div>
                        <div class="float-left">
                            Edit.ExclTax
                            <editor asp-for="OrderShippingExclTaxValue" />
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="PaymentMethodAdditionalFeeInclTaxValue" />
                    </div>
                    <div class="col-md-9">
                        <div class="float-left margin-r-10">
                            Edit.InclTax
                            <editor asp-for="PaymentMethodAdditionalFeeInclTaxValue" />
                        </div>
                        <div class="float-left">
                            Edit.ExclTax
                            <editor asp-for="PaymentMethodAdditionalFeeExclTaxValue" />
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="TaxRatesValue" />
                    </div>
                    <div class="col-md-9">
                        <editor asp-for="TaxRatesValue" />
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="TaxValue" />
                    </div>
                    <div class="col-md-9">
                        <editor asp-for="TaxValue" />
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderTotalDiscountValue" />
                    </div>
                    <div class="col-md-9">
                        <editor asp-for="OrderTotalDiscountValue" />
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderTotalValue" />
                    </div>
                    <div class="col-md-9">
                        <editor asp-for="OrderTotalValue" />
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-md-9 offset-md-3">
                    <button type="submit" name="btnEditOrderTotals" onclick="toggleOrderTotals(true);return false;" id="btnEditOrderTotals" class="btn btn-primary">
                        EditOrderTotals
                    </button>

                    <button type="submit" name="btnSaveOrderTotals" id="btnSaveOrderTotals" class="btn btn-primary margin-r-5">
                        SaveOrderTotals
                    </button>
                    <action-confirmation asp-button-id="btnSaveOrderTotals" />

                    <button type="submit" name="btnCancelOrderTotals" onclick="toggleOrderTotals(false);return false;" id="btnCancelOrderTotals" class="btn btn-secondary">
                        "Admin.Common.Cancel
                    </button>                    
                </div>
            </div>
            
            <div class="form-group row">
                <div class="col-md-3">
                    <label asp-for="PaymentMethod" />
                </div>
                <div class="col-md-9">
                    <div class="form-text-row">@Model.PaymentMethod</div>
                </div>
            </div>

            <div class="form-group row">
                <div class="col-md-3">
                    <label asp-for="PaymentStatus" />
                </div>
                <div class="col-md-9">
                    <div class="form-text-row">@Model.PaymentStatus</div>
                </div>
            </div>
            @if(Model.CanCapture || Model.CanMarkOrderAsPaid || Model.CanRefund || Model.CanRefundOffline ||
              Model.CanPartiallyRefund || Model.CanPartiallyRefundOffline || Model.CanVoid || Model.CanVoidOffline)
            {
                <div class="form-group row">
                    <div class="col-md-9 offset-md-3">
                            @if (Model.CanCapture)
                            {
                                <button type="submit" name="captureorder" id="captureorder" class="btn btn-primary">
                                    Capture
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="captureorder" />
                            }
                            @if (Model.CanMarkOrderAsPaid)
                            {
                                <button type="submit" name="markorderaspaid" id="markorderaspaid" class="btn btn-primary">
                                    MarkAsPaid
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="markorderaspaid" />
                            }
                            @if (Model.CanRefund)
                            {
                                <button type="submit" name="refundorder" id="refundorder" class="btn btn-primary">
                                    Refund
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="refundorder" />
                            }
                            @if (Model.CanRefundOffline)
                            {
                                <button type="submit" name="refundorderoffline" id="refundorderoffline" class="btn btn-primary">
                                    RefundOffline
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="refundorderoffline" />
                            }
                            @if (Model.CanPartiallyRefund)
                            {
                                <button type="submit" id="partiallyrefundorder" name="partiallyrefundorder" onclick="javascript:OpenWindow('@(Url.Action("PartiallyRefundOrderPopup", "Order", new {id = Model.Id, online = true, btnId = "btnRefreshPage", formId = "order-form"}))', 500, 300, true); return false;" class="btn btn-primary">
                                    PartialRefund
                                </button>
                                <text>&nbsp;</text>
                            }
                            @if (Model.CanPartiallyRefundOffline)
                            {
                                <button type="submit" id="partiallyrefundorderoffline" name="partiallyrefundorderoffline" onclick="javascript:OpenWindow('@(Url.Action("PartiallyRefundOrderPopup", "Order", new {id = Model.Id, online = false, btnId = "btnRefreshPage", formId = "order-form"}))', 500, 300, true); return false;" class="btn btn-primary">
                                    PartialRefundOffline
                                </button>
                                <text>&nbsp;</text>
                            }
                            @if (Model.CanVoid)
                            {
                                <button type="submit" name="voidorder" id="voidorder" class="btn btn-primary">
                                    Void
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="voidorder" />
                            }
                            @if (Model.CanVoidOffline)
                            {
                                <button type="submit" name="voidorderoffline" id="voidorderoffline" class="btn btn-primary">
                                    VoidOffline
                                </button>
                                <text>&nbsp;</text>
                                <action-confirmation asp-button-id="voidorderoffline" />
                            }
                        
                    </div>
                </div>
            }
            <div class="form-group row">
                    <div class="col-md-3">
                        <label asp-for="OrderGuid" />
                    </div>
                    <div class="col-md-9">
                        <div class="form-text-row">@Model.OrderGuid</div>
                    </div>
                </div>
            
            <div class="form-group row">
                <div class="col-md-3">
                    <label asp-for="CustomerIp" />
                </div>
                <div class="col-md-9">
                    <div class="form-text-row">@Model.CustomerIp</div>
                </div>
            </div>